<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/p5.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Snake</title>
  </head>
  <body class="h-full m-0">
    <div class="h-full flex justify-center items-center">
      <canvas id="game"></canvas>
    </div>
    <script lang="ts">
      const canvas = document.getElementById("game");

      document.addEventListener("keydown", (event) => {
        const keyName = event.key;

        if (keyName === "ArrowLeft") {
          direction = "LEFT";
        }
        if (keyName === "ArrowRight") {
          direction = "RIGHT";
        }
        if (keyName === "ArrowUp") {
          direction = "UP";
        }
        if (keyName === "ArrowDown") {
          direction = "DOWN";
        }
      });

      const BOARD_HEIGHT = 60;
      const BOARD_WIDTH = 60;
      const cell = 10;
      let snake = [{ x: BOARD_WIDTH / 2, y: BOARD_HEIGHT / 2 }];
      let food = {
        x: Math.floor(Math.random() * BOARD_WIDTH),
        y: Math.floor(Math.random() * BOARD_HEIGHT),
      };

      let direction = "UP";
      let acc = 0;

      const board = Array.from({ length: BOARD_HEIGHT }, () =>
        Array(BOARD_WIDTH).fill(0),
      );

      function setup() {
        createCanvas(600, 600, canvas);
        describe("Snake");
      }

      function draw() {
        background(0);

        acc += min(deltaTime, 50);
        if (acc > 100) {
          move();
          acc = 0;
        }
        drawBoard();
      }

      const drawBoard = () => {
        board.forEach((array, y) => {
          array.forEach((element, x) => {
            stroke(0);
            fill((y + x) % 2 === 0 ? "green" : "lightgreen");
            rect(x * cell, y * cell, cell, cell);

            drawSnake(y, x);
            drawFood(y, x);
          });
        });
      };
      const move = () => {
        const head = snake[0];
        let newHead = { x: head.x, y: head.y };

        switch (direction) {
          case "UP":
            newHead.y -= 1;
            break;
          case "DOWN":
            newHead.y += 1;
            break;
          case "LEFT":
            newHead.x -= 1;
            break;
          case "RIGHT":
            newHead.x += 1;
            break;
        }

        snake.unshift(newHead);

        if (newHead.x === food.x && newHead.y === food.y) {
          food = {
            x: Math.floor(Math.random() * BOARD_WIDTH),
            y: Math.floor(Math.random() * BOARD_HEIGHT),
          };
        } else {
          snake.pop();
        }
      };
      const drawSnake = (y, x) => {
        if (snake.some((segment) => segment.x === x && segment.y === y)) {
          fill("blue");
          rect(x * cell, y * cell, cell, cell);
        }
      };

      const drawFood = (y, x) => {
        if (x === food.x && y === food.y) {
          fill("red");
          rect(x * cell, y * cell, cell, cell);
        }
      };
    </script>
  </body>
</html>
